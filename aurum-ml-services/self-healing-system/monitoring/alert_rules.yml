groups:
  - name: self-healing-system
    rules:
      - alert: HighErrorRate
        expr: rate(self_healing_errors_total[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High error rate in self-healing system"
          description: "Error rate is {{ $value }} errors per second"

      - alert: PatchGenerationFailure
        expr: rate(self_healing_patch_generation_failures_total[5m]) > 0.05
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Patch generation failures detected"
          description: "Patch generation failure rate is {{ $value }} failures per second"

      - alert: ValidationFailure
        expr: rate(self_healing_validation_failures_total[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High validation failure rate"
          description: "Validation failure rate is {{ $value }} failures per second"

      - alert: DatabaseConnectionFailure
        expr: self_healing_database_connection_status != 1
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Database connection failure"
          description: "Cannot connect to database"

      - alert: HighMemoryUsage
        expr: (process_resident_memory_bytes / 1024 / 1024) > 512
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage"
          description: "Memory usage is {{ $value }}MB"

      - alert: LLMRateLimit
        expr: rate(self_healing_llm_rate_limit_hits_total[5m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "LLM rate limit hit"
          description: "Rate limit hit {{ $value }} times per second"

      - alert: SecurityScanFailure
        expr: rate(self_healing_security_scan_failures_total[5m]) > 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Security scan failure"
          description: "Security scan failed {{ $value }} times per second"

      - alert: BuildFailure
        expr: rate(self_healing_build_failures_total[5m]) > 0.1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Build failures detected"
          description: "Build failure rate is {{ $value }} failures per second"
